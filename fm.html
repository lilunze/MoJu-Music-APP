<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>MoJu-Music</title>
	<link rel="stylesheet" href="./src/css/fm.css">
	<script src="src/js/jquery-1.11.3.min.js"></script>
	 <script type="text/javascript">
    	$('html').attr('style','font-size:'+$(window).width()/10+'px');
   		document.addEventListener('plusready', function(){
   			//console.log("所有plus api都应该在此事件发生后调用，否则会出现plus is undefined。"	
   		});
   		
    </script>
</head>
<body>

	<!-- 导航 -->
	<div class="music-well">
		<nav class="nav">
			<div class="logo nav-list"><a href="./index.html">MoJu-Music</a></div>
			<div class="nav-list"><a href="./index.html">发现</a></div>
			<div class="nav-list index"><a href="./fm.html">频道</a></div>
		</nav>
	</div>
	<!-- 导航 -->

	<!-- 内容 -->
	<div class="wrapper">
		<!-- 热度引导 -->
		<div class="fm-list">
			<h1>热门分类</h1>			
			<a class="tags"></a>
		</div>
		<!-- 热度引导 -->

		<!-- 频道内容 -->
		<div class="fm-section">
			<div class='fm-tags-wrapper'>
				<a class='hot-new on' href="javascript:set('new')">最新</a>
				<span >|</span>
				<a class='hot-new' href="javascript:set('hot')">最热</a>	
			</div>
			<h1>热门频道</h1>
			<div class="albums"></div>
		</div>
		<!-- 频道内容 -->
	</div>
	<!-- 内容 -->

	<!-- 模版 -->
	<div class="template" style="display: none;">
		<span id="template-tag" class="fm-tags">
			<a href="" class="jvc-link">
				<img src="" class="jvc-icon"><span class="jvc-tag"></span>
			</a>
		</span>

		<div id="template-album" class="album-wrapper">
				
			<div class="album-img">
				
				<img src="" class="jvc-cover">				
				<div class="album-share">	
					<div class="album-title"><a class="jvc-name"></a></div>
					<span class="icon-box"><i class="icons">&#9835;</i><span class="jvc-sound-count"></span></span>
					<span class="icon-box"><i class="icons">&#10084;</i><span class="jvc-follow"></span></span>
					<span class="icon-box"><i class="icons share">&#10149;</i><span class="jvc-send"></span></span>
				</div>												
			</div>
			
			<div>
				<div class="sound-title">频道热门回声</div>
				<div class="sounds "></div>
			</div>			
		</div>

		<div id="template-sound" class="musics">
			<a href="" class="jvc-sound-link">				
				<img src="" class="jvc-avatar" >				
			</a>	
			<div class="musics-songs">				
				<span class="jvc-singer"></span>
				<span class="jvc-song"></span>
			</div>				
			
		</div>
	</div>

</body>
</html>
<script>
	// 获取频道分类
	$(".hot-new").click(function(){
		$(".hot-new").toggleClass('on')
	})
	$.ajax({
		url:'http://47.94.100.222/change.php',
		dataType:'json',
		data:{'url':'http://www.app-echo.com/api/channel/tag'},
		type:'POST',
		success:function(res){
			var tags=res.categories;
			for(let i=0;i<tags.length;i++)
			{
				let id='tag-'+i;
				$('#template-tag').clone().attr('id',id).appendTo($('.tags')).show();
				$('#'+id).find('.jvc-icon').attr('src',tags[i].icon_url);
				$('#'+id).find('.jvc-tag').html(tags[i].name);				
				$('#'+id).find('.jvc-link').attr('href','javascript:set('+tags[i].id+')');

				$('#'+id).click(function(){
					$('#'+id).css('color','#30EDA8').siblings().css('color','white');
				})
			}
		}
	})

	set('hot');
	function set(type)
	{
		var url='http://www.app-echo.com/api/channel/index?order=hot';
		if(type=='hot')
		{
			url=url;
		}
		else if(type=='new')
		{
			url='http://www.app-echo.com/api/channel/index?order=new';
		}
		else
		{
			url='http://www.app-echo.com/api/channel/index?tag_id='+type;
		}
		get_albums(url);
	}

	// 获取专辑列表
	function get_albums(url)
	{
		$.ajax({
			url:'http://47.94.100.222/change.php',
			dataType:'json',
			data:{'url':url},
			type:'POST',
			success:function(res)
			{
				$('.albums').empty();
				var lists=res.channels;
				// console.log(lists);
				for(var i=0;i<lists.length;i++)
				{
					var id='album-'+i;
					$('#template-album').clone().attr('id',id).appendTo($('.albums')).show();
					$('#'+id).find('.jvc-cover').attr('src',lists[i].pic);
					$('#'+id).find('.jvc-name').attr('src',lists[i].name).html(lists[i].name);
					$('#'+id).find('.jvc-sound-count').html(lists[i].sound_count);
					$('#'+id).find('.jvc-follow').html(lists[i].follow_count);
					$('#'+id).find('.jvc-send').html(lists[i].share_count);

					var fm=lists[i].sound;
					for(var j=0;j<fm.length;j++)
					{
						var ids='fm-'+i+'-'+j;
						$('#template-sound').clone().attr('id',ids).appendTo($('#'+id).find('.sounds')).show();
						$('#'+ids).find('.jvc-avatar').attr('src',fm[j].pic);
						$('#'+ids).find('.jvc-name').html(fm[j].name);
						$('#'+ids).find('.jvc-song').html(fm[j].name);
						$('#'+ids).find('.jvc-singer').html(fm[j].user.name);
						$('#'+ids).find('.jvc-sound-link').attr('href','sound.html?id='+fm[j].id)
					}

				}
			}
		})
	}
	
</script>